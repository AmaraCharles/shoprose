"use strict";(self.webpackChunkcheckout_web=self.webpackChunkcheckout_web||[]).push([[6132],{41953:(e,t,n)=>{n.d(t,{A:()=>g});var o=n(60941),r=n(92972),i=n.n(r),a=n(82242),s=n(91094),c=n(52117),d=n(91647),l=n(14426),u=n(27492);const p=10;const h={Popper:"Pf2ss"};function m({children:e,offset:t,arrowOffset:n,contentWidth:r,contentHeight:i,placement:a="inlineEnd",activator:s,open:c}){const d=function(e){const[t,n]=(0,o.J0)(null),r=(0,o.hb)((()=>{null!==e&&n(e.getBoundingClientRect())}),[e]);return(0,o.Nf)((()=>(r(),window.addEventListener("resize",r),window.addEventListener("scroll",r),()=>{window.removeEventListener("resize",r),window.removeEventListener("scroll",r)})),[r]),t}(s??null),[l,m]=function(){const[e,t]=(0,o.J0)(null);return[e,(0,o.hb)((e=>{null!==e&&t(e.getBoundingClientRect())}),[])]}(),{offsets:f,spacing:v}=(0,o.Kr)((()=>c?function(e,t,n,o,{offset:r=0,arrowOffset:i=0}={}){let a={x:0,y:0},s={left:0,right:0},c=0;if(!t&&!n)return{offsets:a,spacing:c};if(!o){const{clientWidth:e,clientHeight:o}=document.documentElement;return a={x:e/2-t/2,y:o/2-n/2},{offsets:a,spacing:c}}switch(e){case"blockEnd":a={x:"rtl"===(document?.dir??"ltr")?o.left:o.right-t,y:o.bottom+r};break;case"inlineEnd":a={x:"rtl"===(document?.dir??"ltr")?o.left-t-r:o.right+r,y:o.top+o.height/2-i}}return s=function(e,t){const n=document.documentElement.clientWidth,o=e.x+t;let r={left:0,right:0};return o>n&&(r={...r,right:n-o}),e.x<0&&(r={...r,left:-e.x}),r}(a,t),s.right&&!s.left?(a.x+=s.right,c=-p):!s.right&&s.left&&(a.x=0,c=p),{offsets:a,spacing:c}}(a,(r||l?.width)??0,(i||l?.height)??0,d,{offset:t,arrowOffset:n}):{offsets:{x:0,y:0},spacing:0}),[t,n,a,l,d,c,r,i]),{x:g,y:w}=(0,o.Kr)((()=>c?function({x:e,y:t}){const n=window.devicePixelRatio||1;return{x:Math.round(e*n)/n||0,y:Math.round(t*n)/n||0}}({x:f.x+v+(window.scrollX||window.pageXOffset),y:f.y+(window.scrollY||window.pageYOffset)}):{x:0,y:0}),[f,v,c]),y=(0,o.Kr)((()=>c?(window.devicePixelRatio||1)<2?`translate(${g}px, ${w}px)`:`translate3d(${g}px, ${w}px, 0)`:"none"),[c,g,w]);return o.Ay.createElement(u.Z,null,o.Ay.createElement("div",{className:h.Popper,style:{...l&&{transform:y,MozTransform:y,WebkitTransform:y}},ref:m,"aria-hidden":!c},e))}const f={Backdrop:"xMIj4","Backdrop-visible":"VLxei",BackdropLinearGradient:"HL3Ni",Popover:"yw5IT",Content:"sBT8I",PopoverArrow:"tcSqP",PopoverOpen:"cmmgp","Popover-placementInlineEnd":"x9acH","Popover-placementBlockEnd":"mPjCY",Bumper:"bCw1T"},v=(0,s.W)("Popover");function g({children:e,activator:t,open:n,placement:r="inlineEnd",contentWidth:s,contentHeight:u,onClose:p}){const h=(0,o.li)(null),g=(0,o.li)(null),w=(0,o.li)(null),y=(0,d.B)(void 0,v),k=(0,l.ts)(),E=(0,o.hb)((()=>{"BUTTON"===t?.tagName&&(t?.setAttribute("aria-controls",y),t?.setAttribute("aria-expanded",String(n)))}),[t,n,y]),S=(0,o.hb)((e=>{p?.(e)}),[p]),_=(0,o.hb)((e=>{e.target instanceof Node&&!t?.contains(e.target)&&document.contains(e.target)&&!w.current?.contains(e.target)&&n&&S(e)}),[S,t,n,w]),L=(0,o.hb)((e=>{if(n)switch(e.key){case"Escape":case"Esc":S(),t?.focus()}}),[S,t,n]);(0,o.vJ)((()=>(document.addEventListener("click",_),()=>{document.removeEventListener("click",_)})),[_]),(0,o.vJ)((()=>(n&&document.addEventListener("keydown",L,!1),()=>{document.removeEventListener("keydown",L,!1)})),[n,L]),(0,o.vJ)((()=>{E()})),(0,o.Nf)((()=>{n&&w.current?.focus({preventScroll:!0})}),[n]);const P=e=>{const t=w.current;if(t){const n=e?(0,c.ag)(t):(0,c.KB)(t);n?n.focus():t.focus()}},C=i()(f.Popover,f[(0,a.N)("Popover-placement",r)],n&&f.PopoverOpen,t&&f.PopoverArrow);return o.Ay.createElement(o.Ay.Fragment,null,o.Ay.createElement(m,{activator:t,placement:r,offset:15,arrowOffset:30,open:n,contentWidth:s,contentHeight:u},n&&o.Ay.createElement("button",{className:f.Bumper,ref:h,"aria-hidden":"true",onFocus:()=>P(!1)}),o.Ay.createElement("div",{className:C,id:y,ref:w},o.Ay.createElement("div",{className:f.Content},e)),n&&o.Ay.createElement("button",{className:f.Bumper,ref:g,"aria-hidden":"true",onFocus:()=>P(!0)})),o.Ay.createElement("div",{className:i()(f.Backdrop,n&&f["Backdrop-visible"],n&&k&&f.BackdropLinearGradient)}))}},76132:(e,t,n)=>{n.r(t),n.d(t,{default:()=>te});var o=n(60941),r=n(92542),i=n(91612),a=n(20392),s=n(93592),c=n(90334),d=n(27170),l=n(12989),u=n(66126),p=n(43496),h=n(18975),m=n(26748),f=n(90876),v=n(32506),g=n(48463),w=n(12929),y=n(57412),k=n(20917),E=n(17646),S=n(13200),_=n(37160),L=n(82978),P=n(70901),C=n(41953),N=n(71423),b=n(63208),T=n(68877);var $=n(63657),A=n(20763),I=n(86524),V=n(91148),x=n(36719),J=n(3137),M=n(44610),B=n(14225);class R extends Error{constructor(...e){super(...e),this.name="ShopPayError"}}function O({email:e,skipVerifyOnLoad:t,iframeReady:n,iframeRef:r,dismissedModalKey:i,readyToDismiss:s,onReadyToDismiss:c,showPopover:d,showToggle:l,popoverActivator:u}){const p=(0,A.rZ)(),[h]=(0,I.c5)(),{guestDismissedModalKey:g}=(0,V.N)(),{checkoutSessionIdentifier:w}=(0,f.Fo)(),[,k]=(0,m.fp)(P.h),E=(0,m.QN)(),S=(0,J.QV)(M.Z.ShopPayVerification,{scope:B.e5});return(0,o.vJ)((()=>{if(t.current&&n)return void(t.current=!1);const o=p&&(0,v.Ri)(i),s=e&&(0,a.B9)(e),c="connected"===h.status,d=p&&function(){const e=sessionStorage.getItem(y.eQ);if(!e)return!1;const t=Number.parseInt(e,10);return!isNaN(t)&&Date.now()<t}();!n||!s||o||c||d||(E.read(S).value!==x.Vp.Verified?(0,b.L)(r?.current,{action:T.L$.Create,email:e,flow:$.n.Normal,disableAutoFocus:Boolean(sessionStorage.getItem(g))}):E.write(S,void 0))}),[e,n]),{onShow:function(){if(!w)throw new R("Checkout token is undefined");p&&(0,v.Ri)(i)||e&&(0,a.B9)(e)&&(s||c(),(0,v.TV)(y.Sl,escape(w)),(0,v.TV)(y.GH,"false"),window.dispatchEvent(new Event("shop_pay_user_identified_cookie_set")),E.write(S,x.Vp.Pending),sessionStorage.getItem(g)?l?.(!0):(d(!0,e),l?.(!1)))},onHidden:function(){s&&(E.write(S,x.Vp.Dismissed),p&&(0,v.TV)(i,"true"),u?.current?.focus(),d(!1),l?.(!0))},onLoggedIn:function(){(0,a.NW)(),E.write(S,x.Vp.Verified),k("none")}}}var D=n(82668),K=n(56720),F=n(41951),W=n(74720),H=n(24858);class Q extends Error{constructor(...e){super(...e),this.name="ShopPayError"}}const Z=[T.hD.FraudGuard,T.hD.InvalidPhone,T.hD.LimitExceeded,T.hD.PhoneBlocked];function z({email:e,onSetEmail:t,skipVerifyOnLoad:n,iframeReady:r,iframeRef:s,readyToDismiss:c,onReadyToDismiss:d,showPopover:l,popoverActivator:u,origin:p,open:h}){const{checkoutSessionIdentifier:v}=(0,f.Fo)(),{openModal:g}=(0,D.$)(),{exchangeSessionTokenForCookie:w}=(0,K.H)(),[,y]=(0,m.fp)(P.h),k=(0,o.li)(null),E=(0,o.li)(!1),S=(0,F.oO)(),[,_]=(0,W.j1)(),L=(0,o.hb)((()=>{s.current&&(0,b.L)(s.current,{action:T.L$.Create,email:"",flow:$.n.Normal})}),[s]);return(0,o.vJ)((()=>{s.current&&r&&p===i.K.C1ModalShopPaySignIn&&((0,b.L)(s.current,{action:T.L$.AllowNoInitialEmail}),L(),(0,b.L)(s.current,{action:T.L$.Ready}))}),[r,s,p,L]),(0,o.vJ)((()=>{h&&(k.current=null)}),[h]),(0,o.vJ)((()=>{E.current&&s.current&&r&&(E.current=!1,L())})),(0,o.vJ)((()=>{function e(){t&&(S.set({email:"",userStatus:F.$_.None}),t(""),u?.current?.focus()),E.current=!0}return window.addEventListener("shop_pay_verification_reset",e),()=>{window.removeEventListener("shop_pay_verification_reset",e)}}),[u,l,t,s,S]),(0,o.vJ)((()=>{r&&(n.current?n.current=!1:e&&(0,a.B9)(e)&&p!==i.K.C1ModalShopPaySignIn?(S.set({email:e,userStatus:F.$_.Loading}),(0,b.L)(s?.current,{action:T.L$.Create,email:e,flow:$.n.Normal})):p!==i.K.C1ModalShopPaySignIn&&(L(),S.set({email:"",userStatus:F.$_.None})))}),[e,r,n,s,p,S,L,l,_]),{onShow:function(){if(!v)throw new Q("Checkout token is undefined");p===i.K.C1ModalShopPay&&e&&(0,a.B9)(e)&&(c||d(),S.set({email:e,userStatus:F.$_.Found}),l(!0,e))},onHidden:function(){if(p===i.K.C1ModalShopPay&&!c)return;const n=k.current;null!=t&&null!=n&&(n.userStatus!==F.$_.Found||p===i.K.C1ModalShopPay||!e)&&(t(n.email),S.set(n),u?.current?.focus()),S.get().userStatus===F.$_.Found?g({type:H.W.ContinueWithShopPay,email:S.get().email}):u?.current?.focus(),l(!1),k.current=null},onEmailChange:function(e,t){e?(k.current||S.get().email!==e)&&(k.current={email:e,userStatus:t?F.$_.Found:F.$_.New}):k.current={email:"",userStatus:F.$_.None}},onError:function(e,t,n){if((!n||n===S.get().email)&&(e===T.Wu.ShopifyPayUserNotFound&&Z.includes(t)&&(l(!1),g({type:H.W.Generic})),n)){const e=t===T.hD.InvalidEmail;S.set({email:n,userStatus:e?F.$_.Invalid:F.$_.New})}},onLoggedIn:async function(e,t){(0,a.NW)(),y("none"),e&&(await w({token:e,origin:p,in_checkout_profile_preview:t}),window.location.reload())}}}var U=n(6919);function G({email:e,onSetEmail:t,open:n,popoverActivator:r,showPopover:a,showToggle:c,urlOrigin:d=i.K.C1Modal,updatedOrigin:l=d,onIframeLoaded:u}){const $=(0,p.t)({base:"blockEnd",medium:"inlineEnd"}),[A,I]=(0,o.J0)(!1),[V,x]=(0,o.J0)(300),[J,M]=(0,o.J0)(!1),B=(0,h.W)(),{checkoutSessionIdentifier:R}=(0,f.Fo)(),D=(0,o.li)(null),{alternate:K}=(0,S.ft)(),F=K,[W,H]=(0,o.J0)(!1),[,Q]=(0,m.fp)(P.h),Z=(0,m.md)(g.D?.flow)===w.p.UnauthenticatedUser,G=(0,E.d7)(e,y.y4),j=`${R}-${e.replace(/[^a-zA-Z0-9]/g,"")}`,q=(0,k.Q)(),X=(0,o.li)(q),{onShow:Y,onHidden:ee,onError:te,onEmailChange:ne,onLoggedIn:oe}=function(e){const t=(0,s.W$)(),n=(0,o.li)(e),r=n.current,i=e===n.current?void 0:`Callback hook changed from ${n.current.name} to ${e.name} between renders.`;return(0,o.vJ)((()=>{i&&t.notify(new U.BS(`${i} Only the original hook is called.`),{severity:"warning",errorClass:"ShopPay::ShopPayVerification::useStableHook"})}),[i,t]),r}(Z?z:O)({email:G,onSetEmail:t,skipVerifyOnLoad:X,iframeReady:A,iframeRef:D,dismissedModalKey:j,readyToDismiss:J,onReadyToDismiss:()=>{setTimeout((()=>M(!0)),1e3)},showPopover:a,showToggle:c,popoverActivator:r,origin:l,open:n});(0,N.d)({hostname:F,targetId:d,onReady:Y,onClosed:function(){H(!0)},onLoggedIn:oe,onHidden:ee,onError:function(e,t,n){te?.(e,t,n),e===T.Wu.ShopifyPayUserNotFound&&(0,v.TV)(y.Sl,"false"),(0,v.TV)(y.GH,t===T.hD.LimitExceeded?R||"":"false"),window.dispatchEvent(new Event("shop_pay_user_identified_cookie_set"))},onResized:function(e){!isNaN(e)&&e&&x(e)},onLoaded:()=>{I(!0),u()},onEmailChange:ne}),(0,o.vJ)((()=>{(0,b.L)(D?.current,{action:T.L$.OriginChanged,origin:l})}),[l]),(0,o.vJ)((()=>{const e=n?T.L$.Ready:T.L$.Hidden;(0,b.L)(D?.current,{action:e}),Q(n?"shopPayVerification":"none"),D.current&&n&&D.current.focus()}),[n,Q]);const re=(0,L.X)(d);return(0,o.vJ)((()=>()=>{I(!1)}),[re]),re?o.Ay.createElement(C.A,{activator:r?.current??void 0,open:n,onClose:ee,placement:$,contentWidth:320,contentHeight:V},o.Ay.createElement(_.R,{active:W||!A,size:"large"},o.Ay.createElement("iframe",{key:re,id:"shop-pay-verification-iframe",title:B("shop_pay.verification.title","Shop Pay Quick Checkout"),ref:D,src:re,height:V,width:320,className:"hRbIp",allow:"publickey-credentials-get *",referrerPolicy:"origin"}))):null}var j=n(70400),q=n(3377),X=n(99853);const Y=({shopCheckoutModal:e,eventName:t,eventListener:n})=>{(0,o.vJ)((()=>(e?.addEventListener(t,n),()=>e?.removeEventListener(t,n))),[n,t,e])};function ee({email:e,open:t,popoverActivator:n,showPopover:r,showToggle:i,onIframeLoaded:s}){const c=n?.current,d=(0,o.li)(null),[l,u]=(0,o.J0)(!1),p=(0,o.li)(!1),{redirect_url:h,transaction_params:g}=(0,X.I)(),{myshopifyDomain:w}=(0,q.qu)(),E=(0,A.rZ)(),[S]=(0,I.c5)(),{guestDismissedModalKey:_}=(0,V.N)(),{checkoutSessionIdentifier:L}=(0,f.Fo)(),[,C]=(0,m.fp)(P.h);(0,o.vJ)((()=>{customElements.get("shop-checkout-modal")||(0,j.r)()}),[]);const N=(0,m.QN)(),b=(0,J.QV)(M.Z.ShopPayVerification,{scope:B.e5}),T=`${L}-${e.replace(/[^a-zA-Z0-9]/g,"")}`,$=(0,k.Q)(),R=(0,o.li)($);(0,o.vJ)((()=>{if(R.current)return R.current=!1,void u(!1);const e=sessionStorage.getItem(_),t=E&&(0,v.Ri)(T),n="connected"===S.status;if(!(e||t||n))return N.read(b).value===x.Vp.Verified?(N.write(b,void 0),void u(!1)):void u(!0);u(!1)}),[e]);const O=(0,o.hb)((()=>{(0,a.NW)(),N.write(b,x.Vp.Verified),C("none")}),[C,b,N]);Y({shopCheckoutModal:d.current,eventName:"completed",eventListener:O});const D=(0,o.hb)((()=>{if(!L)throw new U.BS("Checkout token is undefined");(0,v.TV)(y.Sl,escape(L)),window.dispatchEvent(new Event("shop_pay_user_identified_cookie_set")),N.write(b,x.Vp.Pending),r?.(!0,e),i?.(!1)}),[L,e,b,r,i,N]);Y({shopCheckoutModal:d.current,eventName:"modalopened",eventListener:D});const K=(0,o.hb)((()=>{N.write(b,x.Vp.Dismissed),E&&(0,v.TV)(T,"true"),r?.(!1),i?.(p.current)}),[E,T,b,r,i,N]);Y({shopCheckoutModal:d.current,eventName:"modalclosed",eventListener:K});const F=(0,o.hb)((()=>{p.current=!0}),[]);Y({shopCheckoutModal:d.current,eventName:"shopusermatched",eventListener:F});const W=(0,o.hb)((e=>{p.current=!1,(0,v.TV)(y.Sl,"false"),window.dispatchEvent(new Event("shop_pay_user_identified_cookie_set"))}),[]);return Y({shopCheckoutModal:d.current,eventName:"shopusernotmatched",eventListener:W}),Y({shopCheckoutModal:d.current,eventName:"loaded",eventListener:s}),(0,o.vJ)((()=>{const e=d.current;C(t?"shopPayVerification":"none"),c&&t&&(e?.open(),c.blur())}),[c,e,t,C]),o.Ay.createElement("shop-checkout-modal",{"anchor-to":c?.id?`#${c.id}`:"","checkout-redirect-url":h,"checkout-token":L,"checkout-version":"checkout_one",email:t||l?e:"",ref:d,"shop-permanent-domain":w,"transaction-params":g})}const te=({email:e,onSetEmail:t,open:n,popoverActivator:p,showPopover:h,showToggle:m,urlOrigin:f=i.K.C1Modal,updatedOrigin:v=i.K.C1Modal})=>{const g=(0,l.a)(u.hZ),w=(0,d.o)(),y=g&&!w,k=(0,s.SU)(),E=(0,o.Kr)((()=>(0,r.S)()),[]),S=(0,o.Kr)((()=>(0,r.S)()),[]),_=(0,o.li)(!0),L=(0,o.Kr)((()=>{if(void 0!==y)return{isC1:!0,shopJsVerification:y}}),[y]);(0,o.vJ)((()=>{(0,a.B9)(e)&&(E.mark("start"),_.current=!0)}),[E,e]),(0,o.vJ)((()=>{if(n&&_.current&&E.marks.start&&L){E.mark("open"),_.current=!1;const e=Math.round(E.marks.open-E.marks.start);k.distribution(c.J.ShopPayVerificationTimeToInteractive,{value:e,tags:L});const t=Math.round(E.marks.open-Math.max(E.marks.start,E.marks.loaded||0));k.distribution(c.J.ShopPayVerificationTimeToInteractiveAfterLoad,{value:t,tags:L})}}),[n,k,E,L]),(0,o.vJ)((()=>{S.mark("start")}),[S]);const P=(0,o.hb)((()=>{if(S.marks.start){S.mark("loaded"),E.mark("loaded");const e=Math.round(S.marks.loaded-S.marks.start);k.distribution(c.J.ShopPayVerificationIframeReadyDuration,{value:e,tags:L})}}),[S,E,k,L]);return y?o.Ay.createElement(ee,{popoverActivator:p,email:e,open:n,showPopover:h,showToggle:m,onIframeLoaded:P}):o.Ay.createElement(G,{popoverActivator:p,email:e,onSetEmail:t,open:n,showPopover:h,showToggle:m,urlOrigin:f,updatedOrigin:v,onIframeLoaded:P})}},56720:(e,t,n)=>{n.d(t,{H:()=>c});var o=n(60941),r=n(13200),i=n(3377),a=n(90876),s=n(41988);const c=()=>{const{myshopifyDomain:e}=(0,i.qu)(),{checkoutSessionIdentifier:t}=(0,a.Fo)(),n=(0,s.j9)();return{exchangeSessionTokenForCookie:(0,o.hb)((async({token:o,origin:i,analytics_trace_id:a,in_checkout_profile_preview:s})=>{const{primary:c}=(0,r.af)(),d=new URLSearchParams({token:o,origin:i,shopify_domain:e});t&&d.set("checkout_token",t),a&&d.set("analytics_trace_id",a),s&&d.set("in_checkout_profile_preview",s),await fetch(`https://${c}${n.shopPaySession()}?${d.toString()}`,{method:"POST",keepalive:!0})}),[t,e,n])}}}}]);