<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard</title>
    <!-- Bootstrap CSS -->
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <!-- toaster -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css" rel="stylesheet"/>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
    
    <style>
        body {
            background-color: #f8f9fa; /* Light grey background */
            font-size: 0.5rem; /* Reduce the base font size to half */
        }
        .sidebar {
            height: 100vh;
            background-color: #007bff; /* Bootstrap blue */
            color: white;
            padding-top: 20px;
            font-size: 1rem; /* Maintain sidebar font size readability */
        }
        .sidebar a {
            color: white;
            text-decoration: none;
        }
        .sidebar a:hover {
            color: #d1e7fd; /* Light blue */
        }
        .card {
            margin: 10px 0;
            height: 100px;
        }
        .card-title {
            font-size: 0.75rem; /* Reduce card title font size */
        }
        .card-text {
            font-size: 1.5rem; /* Reduce card text font size */
        }
        h1, h2 {
            font-size: 1rem; /* Reduce heading sizes */
        }
        @media (max-width: 768px) {
            .sidebar {
                display: none;
            }
        }
    </style>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary d-md-none">
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a class="nav-link" href="allorders.html">All Orders</a>
                </li>
               <li class="nav-item">
                    <a class="nav-link" href="pendingorders.html">New Orders</a>
                </li>
               
                <li class="nav-item">
                    <a class="nav-link" href="confirmedorders.html">Confirmed</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="completedorders.html">Completed</a>
                </li>
            </ul>
            <style>
                .dropdown-item:hover {
                  background-color: rgba(0, 0, 0, 0.1); /* Dims the background on hover */
                }
              </style>
            
            <div class="btn-group">
                <button type="button" class="">Products</button>
                <button type="button" class="btn btn-danger dropdown-toggle dropdown-toggle-split" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                  <span class="sr-only">All products</span>
                </button>
                <div class="dropdown-menu">
                  <a class="dropdown-item" href="create-single.html">Create product</a>
                  <a class="dropdown-item" href="author.html">All products</a>
                  
              </div>
              
        </div>
        
    </nav>
      
    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar for larger screens -->
            <nav class="col-md-2 d-none d-md-block sidebar">
                <div class="sidebar-sticky">
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link active" href="allorders.html">
                                All Orders
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#">
                                Pending
                            </a>
                        </li>
                          <li class="nav-item"></li>
                            <a class="nav-link" href="confirmedorders.html">
                                Confirmed
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="completedorders.html">
                                Completed
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>

            <style>
                .containerr {
                display: flex;
                justify-content: space-between; /* Evenly space the boxes */
                padding: 10px; /* Add padding around the container */
                height: 100px;
              }
              
              .box {
                background-color: #f0f0f0;
                width: 30%; /* Adjust width to take up 30% of the row */
                padding: 5px;
                text-align: center;
                
                border: 1px solid #ccc;
                border-radius: 5px;
              }
              .box2 {
                background-color: #f0f0f0;
                padding: 5px;
                text-align: center;
                height: 130px;
                border: 1px solid #ccc; /* Border for visibility */
                margin-bottom: 5px;
                border: 1px solid #ccc;
                border-radius: 5px;
              }
              
              
              </style>
            <!-- Main Dashboard -->
            <main role="main" class="col-md-9 ml-sm-auto col-lg-10 px-md-4">
                <div class="container my-4">
                    <div class="col-12">
                        <div><b>Items</b> (<span id="totalOrders">0</span>)</div>
                        <div class="alert alert-info p-4 my-3">
                            <h5 class="mb-3">Order Confirmation</h5>
                            <p>
                              This package was ordered by <strong id="name" class="text-primary"></strong> with the email 
                              <strong id="email" class="text-secondary"></strong> on 
                              <strong id="date" class="text-success"></strong>.
                            </p>
                            <p class="mb-0">
                              Please check your bank app before confirming payment.
                            </p>
                          </div>
                        <!-- Box content -->
                        <div class="row" id="containerrr">
                  
                        </div>
                        <div style="display: flex;align-items: center; justify-content: center;">
                        <button type="submit" class="btn btn-md btn-success me-2" id="updateBtn">
                            Confirm 
                        </button>
                    </div>
                      </div>


                  </div>
                  
            </main>
        </div>
    </div>

    <!-- Bootstrap JS and dependencies -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.3/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
</body>
<script>
toastr.options = {
  "closeButton": true,              // Show close button
  "debug": false,                   // Disable debugging
  "newestOnTop": true,              // Alerts appear on top of previous alerts
  "progressBar": true,              // Show a progress bar
  "positionClass": "toast-top-right", // Positioning at the top-right corner
  "preventDuplicates": true,        // Prevent duplicate alerts
  "showDuration": "300",            // Fade-in duration in ms
  "hideDuration": "1000",           // Fade-out duration in ms
  "timeOut": "5000",                // Time before auto-hide in ms
  "extendedTimeOut": "1000",        // Extra time for mouse hover
  "showEasing": "swing",            // Show easing effect
  "hideEasing": "linear",           // Hide easing effect
  "showMethod": "fadeIn",           // Fade in
  "hideMethod": "fadeOut"           // Fade out
};
function showOrderCompletedAlert() {
  toastr.success('Order Confirmed successfully!');
}

// Example usage when an order is completed

let currentColor;
async function fetchUserInfo() {
var parsedData = localStorage.getItem('userId')


const response = await $.ajax({
  type: "GET",
  url: `https://rose-heroku-dc607cde99d9.herokuapp.com/users/package/${parsedData}`,
  dataType: "json",
  timeout: 30000,
  success: async function (data) {
    console.log("data", data);
   
  },
  error: function () {
    alert(error)
  }
 
});

return response.data;
}


async function updateProfile({ _id,firstName,lastName,item,address,status}) {
  console.log(_id,firstName,lastName,item,address,status);
//   console.log(currentUser);

  const response = await $.ajax({
    type: "PUT",
    url: `https://rose-heroku-dc607cde99d9.herokuapp.com/users/${_id}/profile/update`,
    dataType: "json",
    data: { _id,firstName,lastName,item,address,status },
    timeout: 30000,
    success: function () {
        alert("order confirmed!")
      setTimeout(function () {$(location).prop('href', './confirmedorders.html')     
                   }, 1000 * 3)

    }
  });

  console.log(response);
  return response.data
}



$('#updateBtn').click(async function (e) {
  e.preventDefault();
const newOrder=localStorage.getItem("newOrder")
const parseNewOrder=JSON.parse(newOrder)

parseNewOrder.status="confirmed"
console.log(parseNewOrder);

var _id=parseNewOrder._id
var firstName=parseNewOrder.firstName
var lastName=parseNewOrder.lastName
var item=parseNewOrder.item
var address=parseNewOrder.address
var status=parseNewOrder.status

await updateProfile({_id,firstName,lastName,item,address,status })











})

    function hail(artworkJson) {
      const artwork = decodeURIComponent(artworkJson);
      localStorage.setItem("pricing", artwork)
      location.href = "./products/product.html"
    }
    function hail2(collectionJson) {
      const artwork = decodeURIComponent(collectionJson);
      localStorage.setItem("pricing", artwork)
      location.href = "buy.html"
    }
  
  let counter=0;
  let allItemsCounter=0;
    $(document).ready(async function () {
  
      // Assuming fetchUserInfo() is a defined function that fetches user information
      // const userLis =localStorage.getItem("users")
      const orderInfo = await fetchUserInfo();
$("#name").text(orderInfo.firstName + " "+ orderInfo.lastName)
$("#email").text(orderInfo.email)

$("#totalOrders").text(orderInfo.item.length)
  localStorage.setItem("orderStatus",orderInfo.status)
    
        console.log("all users artworks can be seen below" + orderInfo.item);
        orderInfo.item.forEach(itm => {
          counter++;
          if (itm) {
            const artworkJson = encodeURIComponent(JSON.stringify(itm));
            const smart = itm

  const parseImgUrlArray=JSON.parse(itm.imgUrl)
  const imgUrl=parseImgUrlArray[0]
  const status=localStorage.getItem("orderStatus")
            const artworkHtml = `
          
          <a class="col-6 col-lg-3" onclick='hail("${artworkJson}")'>
            <div class="box2">
               <img src="${imgUrl}" alt="Product" class="img-responsive" style="width:100%; height:100%;" />
              
              </div>
              <div class="info mb-2" id="info" >
              <div style="color:#7b3700">Title:${itm.title}</div>
              <div>Size:${itm.size}</div>
              
              <div>Price:â‚¦${itm.price}</div>
              <div>Satus:${status}
              </div>
              
              
          </div>
         
     
               `;
            $('#containerrr').append(artworkHtml);
          }
        }
        )
  
  
      });
    
  
    ;
  
  </script>
  
  
    
</html>
